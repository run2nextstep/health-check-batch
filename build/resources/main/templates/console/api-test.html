<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Test - Health Check Batch</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .api-container { margin-top: 30px; }
    .endpoint-card { margin-bottom: 15px; }
    .response-area {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 5px;
      font-family: monospace;
      max-height: 300px;
      overflow-y: auto;
    }
    .method-get { color: #28a745; font-weight: bold; }
    .method-post { color: #007bff; font-weight: bold; }
    .success { color: #28a745; }
    .error { color: #dc3545; }
  </style>
</head>
<body>
<div class="container api-container">
  <div class="row">
    <div class="col-12">
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">üîå Health Check Batch API Test Console</h4>
          <small>Test all API endpoints directly from your browser</small>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <strong>üí° Tip:</strong> Click any button below to test the corresponding API endpoint. Results will appear in the response area.
          </div>

          <!-- Navigation Links -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>üåê Related Links:</h6>
              <div class="btn-group-vertical w-100">
                <a href="/console/" class="btn btn-outline-primary btn-sm">
                  üìä Web Console Dashboard
                </a>
                <a href="/h2-console" class="btn btn-outline-secondary btn-sm" target="_blank">
                  üóÑÔ∏è H2 Database Console
                </a>
              </div>
            </div>
            <div class="col-md-6">
              <h6>üìã Response Area:</h6>
              <div id="generalResponse" class="response-area">
                <em class="text-muted">API responses will appear here...</em>
              </div>
            </div>
          </div>

          <!-- API Endpoints -->
          <div class="row">
            <!-- Basic Info Endpoints -->
            <div class="col-md-6">
              <h5>üìä Information Endpoints</h5>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/</h6>
                  <p class="small text-muted">API information and available endpoints</p>
                  <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/batch/', 'GET')">
                    Test API Info
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/health</h6>
                  <p class="small text-muted">Application health status</p>
                  <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/batch/health', 'GET')">
                    Test Health
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/config</h6>
                  <p class="small text-muted">View application configuration</p>
                  <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/batch/config', 'GET')">
                    Test Config
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/stats</h6>
                  <p class="small text-muted">View statistics and metrics</p>
                  <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/batch/stats', 'GET')">
                    Test Stats
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/test</h6>
                  <p class="small text-muted">Simple test endpoint for debugging</p>
                  <button class="btn btn-success btn-sm" onclick="testEndpoint('/api/batch/test', 'GET')">
                    Test Debug
                  </button>
                </div>
              </div>
            </div>

            <!-- Action Endpoints -->
            <div class="col-md-6">
              <h5>üöÄ Action Endpoints</h5>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/trigger</h6>
                  <p class="small text-muted">Trigger manual health check batch</p>
                  <button class="btn btn-primary btn-sm" onclick="testEndpoint('/api/batch/trigger', 'GET')">
                    Trigger Health Check
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/check-now</h6>
                  <p class="small text-muted">Immediate health check with detailed results</p>
                  <button class="btn btn-primary btn-sm" onclick="testEndpoint('/api/batch/check-now', 'GET')">
                    Check Now
                  </button>
                </div>
              </div>

              <div class="card endpoint-card">
                <div class="card-body">
                  <h6><span class="method-get">GET</span> /api/batch/telegram/test</h6>
                  <p class="small text-muted">Test Telegram notification (if configured)</p>
                  <button class="btn btn-info btn-sm" onclick="testEndpoint('/api/batch/telegram/test', 'GET')">
                    Test Telegram
                  </button>
                </div>
              </div>

              <!-- POST Methods -->
              <div class="card endpoint-card border-primary">
                <div class="card-body">
                  <h6><span class="method-post">POST</span> /api/batch/trigger</h6>
                  <p class="small text-muted">Trigger health check (POST method)</p>
                  <button class="btn btn-primary btn-sm" onclick="testEndpoint('/api/batch/trigger', 'POST')">
                    POST Trigger
                  </button>
                </div>
              </div>

              <div class="card endpoint-card border-info">
                <div class="card-body">
                  <h6><span class="method-post">POST</span> /api/batch/telegram/test</h6>
                  <p class="small text-muted">Test Telegram (POST method)</p>
                  <button class="btn btn-info btn-sm" onclick="testEndpoint('/api/batch/telegram/test', 'POST')">
                    POST Telegram
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Test All Button -->
          <div class="row mt-4">
            <div class="col-12 text-center">
              <button class="btn btn-warning btn-lg" onclick="testAllEndpoints()">
                üß™ Test All Endpoints
              </button>
              <button class="btn btn-secondary btn-lg ms-2" onclick="clearResponse()">
                üóëÔ∏è Clear Response
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  function testEndpoint(url, method = 'GET') {
    const responseArea = document.getElementById('generalResponse');

    // Show loading
    responseArea.innerHTML = `
                <div class="text-info">
                    <strong>üîÑ Testing ${method} ${url}</strong><br>
                    <em>Please wait...</em>
                </div>
            `;

    const options = {
      method: method,
      headers: {
        'Content-Type': 'application/json',
      }
    };

    fetch(url, options)
      .then(response => {
        const statusClass = response.ok ? 'success' : 'error';
        return response.json().then(data => ({
          status: response.status,
          statusText: response.statusText,
          data: data,
          ok: response.ok
        }));
      })
      .then(result => {
        const statusClass = result.ok ? 'success' : 'error';
        const statusIcon = result.ok ? '‚úÖ' : '‚ùå';

        responseArea.innerHTML = `
                        <div class="${statusClass}">
                            <strong>${statusIcon} ${method} ${url}</strong><br>
                            <strong>Status:</strong> ${result.status} ${result.statusText}<br>
                            <strong>Response:</strong>
                        </div>
                        <pre>${JSON.stringify(result.data, null, 2)}</pre>
                        <hr>
                        <small class="text-muted">Time: ${new Date().toLocaleString()}</small>
                    `;
      })
      .catch(error => {
        responseArea.innerHTML = `
                        <div class="error">
                            <strong>‚ùå ${method} ${url}</strong><br>
                            <strong>Error:</strong> ${error.message}<br>
                        </div>
                        <hr>
                        <small class="text-muted">Time: ${new Date().toLocaleString()}</small>
                    `;
      });
  }

  function testAllEndpoints() {
    const endpoints = [
      {url: '/api/batch/', method: 'GET'},
      {url: '/api/batch/health', method: 'GET'},
      {url: '/api/batch/test', method: 'GET'},
      {url: '/api/batch/config', method: 'GET'},
      {url: '/api/batch/stats', method: 'GET'},
    ];

    const responseArea = document.getElementById('generalResponse');
    responseArea.innerHTML = '<div class="text-info"><strong>üß™ Testing all endpoints...</strong></div>';

    let results = [];
    let completed = 0;

    endpoints.forEach((endpoint, index) => {
      setTimeout(() => {
        fetch(endpoint.url, {method: endpoint.method})
          .then(response => response.json().then(data => ({
            endpoint: endpoint,
            status: response.status,
            ok: response.ok,
            data: data
          })))
          .then(result => {
            results.push(result);
            completed++;

            if (completed === endpoints.length) {
              displayAllResults(results);
            }
          })
          .catch(error => {
            results.push({
              endpoint: endpoint,
              error: error.message
            });
            completed++;

            if (completed === endpoints.length) {
              displayAllResults(results);
            }
          });
      }, index * 500); // Stagger requests
    });
  }

  function displayAllResults(results) {
    const responseArea = document.getElementById('generalResponse');
    let html = '<div><strong>üß™ All Endpoints Test Results:</strong><br><br>';

    results.forEach(result => {
      const icon = result.ok ? '‚úÖ' : '‚ùå';
      const status = result.status ? `(${result.status})` : '';
      const endpoint = result.endpoint;

      html += `
                    <div class="mb-2">
                        ${icon} <strong>${endpoint.method} ${endpoint.url}</strong> ${status}<br>
                        ${result.error ? `<span class="error">Error: ${result.error}</span>` :
        `<span class="success">Status: ${result.data?.status || 'OK'}</span>`}
                    </div>
                `;
    });

    html += `<hr><small class="text-muted">Completed: ${new Date().toLocaleString()}</small></div>`;
    responseArea.innerHTML = html;
  }

  function clearResponse() {
    document.getElementById('generalResponse').innerHTML =
      '<em class="text-muted">API responses will appear here...</em>';
  }

  // Auto-test API info on page load
  setTimeout(() => {
    testEndpoint('/api/batch/', 'GET');
  }, 1000);
</script>
</body>
</html>

<!--
Ïù¥ ÌååÏùºÏùÄ src/main/resources/static/ Ìè¥ÎçîÏóê ÏúÑÏπòÌï¥Ïïº Ìï©ÎãàÎã§.
Ï†ëÏÜç URL: http://localhost:8080/api-test.html
-->