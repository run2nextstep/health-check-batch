<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{console/layout :: layout(~{::content}, ~{::scripts}, 'Target Servers')}">
<head>
  <title>Target Servers</title>
</head>
<body>
<div th:fragment="content">
  <!-- Search and Actions Bar -->
  <div class="row mb-3">
    <div class="col-md-6">
      <form method="get" action="/console/servers" class="d-flex">
        <input type="text" class="form-control me-2" name="search"
               th:value="${search}" placeholder="Search servers...">
        <button type="submit" class="btn btn-outline-secondary">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>
    <div class="col-md-6 text-end">
      <a href="/console/servers/new" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add New Server
      </a>
    </div>
  </div>

  <!-- Servers Table -->
  <div class="card shadow">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
        Target Servers
        <span class="badge bg-info" th:text="${#lists.size(servers)}">0</span>
      </h6>
    </div>
    <div class="card-body">
      <div th:if="${#lists.isEmpty(servers)}" class="text-center text-muted py-4">
        <i class="fas fa-server fa-3x mb-3"></i>
        <h5>No servers found</h5>
        <p th:if="${search != null and !search.isEmpty()}">
          No servers match your search criteria: "<span th:text="${search}"></span>"
        </p>
        <p th:unless="${search != null and !search.isEmpty()}">
          Get started by adding your first target server.
        </p>
        <a href="/console/servers/new" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add First Server
        </a>
      </div>

      <div th:unless="${#lists.isEmpty(servers)}" class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
          <tr>
            <th>Status</th>
            <th>Name</th>
            <th>URL</th>
            <th>Method</th>
            <th>Timeout</th>
            <th>Environment</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="server : ${servers}">
            <td>
                                    <span th:if="${server.enabled}" class="badge bg-success" data-bs-toggle="tooltip"
                                          title="Active">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
              <span th:unless="${server.enabled}" class="badge bg-secondary" data-bs-toggle="tooltip" title="Disabled">
                                        <i class="fas fa-pause-circle"></i>
                                    </span>
            </td>
            <td>
              <strong th:text="${server.name}"></strong>
              <br>
              <small class="text-muted" th:text="${server.description}"></small>
            </td>
            <td>
              <code th:text="${server.url}"></code>
            </td>
            <td>
                                    <span class="badge"
                                          th:classappend="${server.method == 'GET' ? 'bg-info' : 'bg-warning'}"
                                          th:text="${server.method}"></span>
            </td>
            <td th:text="${server.timeout} + 'ms'"></td>
            <td>
              <span class="badge bg-secondary" th:text="${server.environment}"></span>
            </td>
            <td th:text="${#temporals.format(server.createdAt, 'MM-dd HH:mm')}"></td>
            <td>
              <div class="btn-group" role="group">
                <a th:href="@{'/console/servers/' + ${server.id} + '/edit'}"
                   class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="Edit">
                  <i class="fas fa-edit"></i>
                </a>
                <a th:href="@{'/console/servers/' + ${server.id} + '/logs'}"
                   class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip" title="View Logs">
                  <i class="fas fa-list"></i>
                </a>
                <form th:action="@{'/console/servers/' + ${server.id} + '/toggle'}"
                      method="post" style="display: inline;">
                  <button type="submit" class="btn btn-sm btn-outline-warning"
                          data-bs-toggle="tooltip"
                          th:title="${server.enabled ? 'Disable' : 'Enable'}">
                    <i th:class="${server.enabled ? 'fas fa-pause' : 'fas fa-play'}"></i>
                  </button>
                </form>
                <form th:action="@{'/console/servers/' + ${server.id} + '/delete'}"
                      method="post" style="display: inline;"
                      onsubmit="return confirmDelete('Are you sure you want to delete this server?')">
                  <button type="submit" class="btn btn-sm btn-outline-danger"
                          data-bs-toggle="tooltip" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Server Stats -->
  <div th:unless="${#lists.isEmpty(servers)}" class="row mt-4">
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-success" th:text="${#lists.size(servers.?[enabled])}">0</h5>
          <p class="card-text">Active Servers</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-secondary" th:text="${#lists.size(servers.?[!enabled])}">0</h5>
          <p class="card-text">Disabled Servers</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title text-info" th:text="${#lists.size(servers)}">0</h5>
          <p class="card-text">Total Servers</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div th:fragment="scripts">
  <script>
    // Initialize tooltips
    $(document).ready(function () {
      $('[data-bs-toggle="tooltip"]').tooltip();
    });

    // Clear search
    function clearSearch() {
      window.location.href = '/console/servers';
    }
  </script>
</div>
</body>
</html>